
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bird Art Prompt Randomizer</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@600;700&family=Source+Sans+3:wght@400;500;600&display=swap');
    :root {
      --forest: #1F6F50;
      --ink: #1C1C1E;
      --sand: #F3EDE2;
      --sky: #E6F3F8;
      --card: rgba(255, 255, 255, 0.92);
      --border: rgba(31, 111, 80, 0.17);
      --shadow: 0 20px 45px rgba(12, 32, 20, 0.12);
      font-family: 'Source Sans 3', 'Segoe UI', system-ui, sans-serif;
      background-color: var(--sand);
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      min-height: 100vh;
      background: var(--sand);
      color: var(--ink);
      display: flex;
      justify-content: center;
      padding: 2rem 1rem 3rem;
    }
    .page-shell {
      width: 100%;
      max-width: 960px;
    }
    .page {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .card {
      background: var(--card);
      border-radius: 22px;
      padding: 1.6rem;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }
    .hero-card {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .hero-copy h1 {
      margin: 0 0 0.2rem;
      font-family: 'Inter', 'Poppins', sans-serif;
      font-size: clamp(2rem, 4vw, 2.8rem);
      line-height: 1.1;
      color: var(--ink);
    }
    .hero-copy p {
      margin: 0;
      color: #2f3430;
      font-size: 1rem;
    }
    .eyebrow {
      text-transform: uppercase;
      letter-spacing: 0.25em;
      font-size: 0.75rem;
      color: #4e6257;
      margin: 0;
    }
    .hero-actions {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .primary-btn {
      border: none;
      background: var(--forest);
      color: white;
      font-weight: 600;
      border-radius: 999px;
      padding: 0.75rem 1.6rem;
      font-size: 1rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.6rem;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      box-shadow: 0 10px 20px rgba(31, 111, 80, 0.3);
    }
    .primary-btn:disabled {
      opacity: 0.65;
      cursor: wait;
      box-shadow: none;
    }
    .primary-btn:not(:disabled):active {
      transform: translateY(1px);
      box-shadow: 0 6px 10px rgba(31, 111, 80, 0.35);
    }
    .primary-btn .spinner {
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255, 255, 255, 0.5);
      border-top-color: #f3ede2;
      border-radius: 50%;
      animation: spin 0.9s linear infinite;
      opacity: 0;
      transition: opacity 0.18s ease;
    }
    .primary-btn.loading .spinner {
      opacity: 1;
    }
    .primary-btn .btn-label {
      display: inline-block;
    }
    .status {
      margin: 0;
      font-size: 0.9rem;
      color: #4e6257;
      min-height: 1.2rem;
    }
    .status[data-state='error'] {
      color: #b00020;
    }
    .status[data-state='success'] {
      color: var(--forest);
    }
    .filters-card {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
    }
    .filter-group label {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: #4e6257;
      margin-bottom: 0.35rem;
    }
    .filter-group select {
      width: 100%;
      padding: 0.65rem 0.75rem;
      border-radius: 12px;
      border: 1px solid rgba(0, 0, 0, 0.12);
      font-size: 1rem;
      background: #fff;
      outline: none;
      font-family: 'Source Sans 3', sans-serif;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.08);
      transition: border 0.2s ease;
    }
    .filter-group select:focus {
      border-color: var(--forest);
    }
    .locks-card {
      padding-top: 1.25rem;
    }
    .lock-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 0.75rem;
    }
    .lock-btn {
      border: 1px solid rgba(28, 28, 30, 0.1);
      background: #fff;
      border-radius: 16px;
      padding: 0.65rem;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      justify-content: center;
      transition: all 0.2s ease;
      color: var(--ink);
    }
    .lock-btn .icon {
      font-size: 1rem;
    }
    .lock-btn.active {
      border-color: var(--forest);
      background: rgba(31, 111, 80, 0.12);
      color: var(--forest);
      box-shadow: 0 10px 20px rgba(31, 111, 80, 0.15);
    }
    .prompt-card {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }
    .prompt-output {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .prompt-output .label {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: #4e6257;
    }
    .prompt-text {
      border-radius: 18px;
      border: 1px solid rgba(31, 111, 80, 0.25);
      background: #fff;
      padding: 1rem 1.25rem;
      min-height: 120px;
      font-size: 1.05rem;
      line-height: 1.5;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.08);
      position: relative;
      overflow: hidden;
    }
    .ghost-btn {
      align-self: flex-end;
      background: transparent;
      border: 1px solid rgba(31, 111, 80, 0.5);
      border-radius: 999px;
      padding: 0.5rem 1.2rem;
      color: var(--forest);
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.18s ease;
    }
    .ghost-btn:active {
      transform: translateY(1px);
    }
    .bird-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 0.9rem;
    }
    .bird-details .label {
      margin: 0;
      font-size: 0.75rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: #4e6257;
    }
    .value {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
      color: var(--ink);
    }
    .value em {
      font-style: italic;
      color: #3c423d;
      font-weight: 500;
    }
    .reference-panel figure {
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }
    .reference-panel img {
      width: 100%;
      border-radius: 18px;
      object-fit: cover;
      min-height: 180px;
      max-height: 360px;
      display: block;
    }
    .reference-panel a {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      color: var(--forest);
      font-weight: 600;
      text-decoration: none;
      font-size: 0.95rem;
    }
    .reference-panel a:hover {
      text-decoration: underline;
    }
    .favorites-history {
      display: grid;
      gap: 1rem;
    }
    .favorites-block,
    .history-block {
      background: #fff;
      border-radius: 18px;
      padding: 1.25rem;
      border: 1px solid rgba(28, 28, 30, 0.08);
    }
    .section-header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
    }
    .section-header h2 {
      margin: 0;
      font-family: 'Inter', 'Poppins', sans-serif;
      font-size: 1.2rem;
    }
    .secondary-btn {
      border-radius: 12px;
      border: 1px solid rgba(31, 111, 80, 0.6);
      background: #fff;
      color: var(--forest);
      padding: 0.5rem 1.25rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.18s ease;
    }
    .secondary-btn:active {
      transform: translateY(1px);
    }
    .list-grid {
      display: flex;
      flex-direction: column;
      gap: 0.9rem;
      margin-top: 0.8rem;
    }
    .helper {
      margin: 0;
      font-size: 0.85rem;
      color: #5c655e;
    }
    .favorite-card,
    .history-card {
      border: 1px solid rgba(31, 111, 80, 0.2);
      border-radius: 14px;
      padding: 0.9rem 1rem;
      background: #f9fafc;
      box-shadow: 0 8px 12px rgba(0, 0, 0, 0.05);
    }
    .prompt-snippet {
      margin: 0 0 0.5rem;
      font-size: 0.95rem;
      line-height: 1.3;
    }
    .history-actions,
    .favorite-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .history-actions button,
    .favorite-meta button {
      border: none;
      background: rgba(31, 111, 80, 0.12);
      color: var(--forest);
      padding: 0.35rem 0.9rem;
      border-radius: 999px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .history-actions button:hover,
    .favorite-meta button:hover {
      background: rgba(31, 111, 80, 0.2);
    }
    .timestamp {
      font-size: 0.8rem;
      color: #5c655e;
    }
    .footer-card {
      margin-top: 1rem;
      text-align: center;
      font-size: 0.85rem;
      color: #4e6257;
      border-radius: 18px;
      border: 1px solid rgba(28, 28, 30, 0.08);
    }
    .favorite-card button {
      margin-left: auto;
    }
    .primary-btn.loading {
      pointer-events: none;
    }
    .prompt-card.fresh {
      animation: softGlow 0.7s ease;
    }
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    @keyframes softGlow {
      0% {
        transform: translateY(6px);
        opacity: 0.85;
      }
      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }
    @media (min-width: 768px) {
      .hero-actions {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
      }
      .hero-card {
        flex-direction: row;
        align-items: flex-start;
        justify-content: space-between;
      }
      .hero-copy {
        max-width: 60%;
      }
      .prompt-card {
        flex-direction: column;
      }
      .reference-panel img {
        min-height: 220px;
      }
      .favorites-history {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      .filters-card {
        grid-template-columns: repeat(2, minmax(220px, 1fr));
      }
    }
  </style>
</head>
<body>
  <div class="page-shell">
    <main class="page" aria-live="polite">
      <header class="hero-card card">
        <div class="hero-copy">
          <p class="eyebrow">Field-guided inspiration</p>
          <h1>Bird Art Prompt Randomizer</h1>
          <p>Blend real species reference imagery with curated actions, styles, and views to spark fresh bird art studies.</p>
        </div>
        <div class="hero-actions">
          <button id="generateBtn" class="primary-btn" type="button" aria-live="polite">
            <span class="btn-label">Generate Prompt</span>
            <span class="spinner" aria-hidden="true"></span>
          </button>
          <p id="statusMessage" class="status" aria-live="polite">Tap generate to invite a feathered muse.</p>
        </div>
      </header>
      <section class="card filters-card">
        <div class="filter-group">
          <label for="lifeSelect">Life Status <span class="icon">ü™∂</span></label>
          <select id="lifeSelect">
            <option value="Any">Any</option>
            <option value="Living">Living</option>
            <option value="Extinct">Extinct</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="regionSelect">Region <span class="icon">üìç</span></label>
          <select id="regionSelect">
            <option value="Any">Any</option>
            <option value="North America">North America</option>
            <option value="South America">South America</option>
            <option value="Europe">Europe</option>
            <option value="Africa">Africa</option>
            <option value="Asia">Asia</option>
            <option value="Oceania">Oceania</option>
            <option value="Island">Island</option>
          </select>
        </div>
      </section>
      <section class="card locks-card">
        <div class="lock-grid">
          <button class="lock-btn" data-lock="bird" type="button" aria-pressed="false"><span class="icon">ü™∂</span>Lock Bird</button>
          <button class="lock-btn" data-lock="action" type="button" aria-pressed="false"><span class="icon">üåÄ</span>Lock Action</button>
          <button class="lock-btn" data-lock="style" type="button" aria-pressed="false"><span class="icon">üé®</span>Lock Style</button>
          <button class="lock-btn" data-lock="view" type="button" aria-pressed="false"><span class="icon">üëÅÔ∏è</span>Lock View</button>
          <button class="lock-btn" data-lock="lifeStatus" type="button" aria-pressed="false"><span class="icon">‚öñÔ∏è</span>Lock Life Status</button>
          <button class="lock-btn" data-lock="region" type="button" aria-pressed="false"><span class="icon">üó∫Ô∏è</span>Lock Region</button>
        </div>
      </section>
      <section class="card prompt-card">
        <div class="prompt-output">
          <p class="label">Prompt</p>
          <div class="prompt-text" id="promptText">Tap ‚ÄúGenerate Prompt‚Äù to start.</div>
          <button id="copyPrompt" class="ghost-btn" type="button">Copy Prompt</button>
        </div>
        <div class="bird-details">
          <div>
            <p class="label">Common Name</p>
            <p class="value" id="birdCommon">‚Äî</p>
          </div>
          <div>
            <p class="label">Scientific Name</p>
            <p class="value"><em id="scientificName">‚Äî</em></p>
          </div>
          <div>
            <p class="label">Life Status</p>
            <p class="value" id="detailLifeStatus">‚Äî</p>
          </div>
          <div>
            <p class="label">Region</p>
            <p class="value" id="detailRegion">‚Äî</p>
          </div>
        </div>
        <div class="reference-panel">
          <figure>
            <img id="referenceImage" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300'%3E%3C/svg%3E" alt="Bird reference will appear here" loading="lazy" />
            <figcaption>
              <a id="referenceLink" href="#" target="_blank" rel="noreferrer">Source image on Wikipedia ‚Üó</a>
            </figcaption>
          </figure>
        </div>
      </section>
      <section class="card favorites-history">
        <div class="favorites-block">
          <div class="section-header">
            <h2>Favorites</h2>
            <button id="saveFavorite" class="secondary-btn" type="button">Save Favorite</button>
          </div>
          <div id="favoritesList" class="list-grid">
            <p class="helper">Save prompts you love to revisit.</p>
          </div>
        </div>
        <div class="history-block">
          <div class="section-header">
            <h2>History</h2>
            <p class="helper">Last 10 prompts ‚Ä¢ tap to reload.</p>
          </div>
          <div id="historyList" class="list-grid">
            <p class="helper">History logs appear after you generate.</p>
          </div>
        </div>
      </section>
    </main>
    <footer class="footer-card card">
      <p>Images from Wikipedia/Wikimedia. Data from Wikidata. No tracking ‚Äî favorites & history stay local.</p>
    </footer>
  </div>
  <script>
    (() => {
      const actionsList = [
        'perched on a branch',
        'soaring mid-flight',
        'hunting over water',
        'preening feathers',
        'feeding chicks',
        'calling loudly',
        'wading in shallows',
        'hovering above flowers',
        'diving for fish',
        'dust bathing',
        'opening wings to sun',
        'gliding over cliffs',
        'nesting on a ledge',
        'pecking at bark',
        'scratching the ground',
        'balancing on a reed',
        'resting on driftwood',
        'chasing insects',
        'carrying nesting material',
        'sipping nectar',
        'strutting on display',
        'swimming calmly',
        'leaping from a perch',
        'shaking off rain'
      ];
      const stylesList = [
        'watercolor wash',
        'ink line art',
        'vintage field-guide plate',
        'low-poly geometric',
        'charcoal sketch',
        'pastel painting',
        'cyberpunk neon',
        'ukiyo-e inspired',
        'minimal flat',
        'photorealistic study',
        'abstract shapes',
        'stained-glass mosaic',
        'impressionist brushwork',
        'paper cut-out',
        'bold poster art',
        'pixel art',
        'colored pencil',
        'mid-century modern'
      ];
      const viewsList = [
        'side profile',
        'three-quarter view',
        'frontal portrait',
        'top-down',
        'wings spread',
        'close-up headshot',
        'full-body',
        'in-environment scene',
        'silhouette at sunset',
        'macro detail of plumage'
      ];
      const birds = [
        {
          commonName: 'Northern Cardinal',
          scientificName: 'Cardinalis cardinalis',
          lifeStatus: 'Living',
          region: 'North America',
          image: 'https://upload.wikimedia.org/wikipedia/commons/1/1f/Cardinalis_cardinalis_male.jpg',
          wiki: 'https://en.wikipedia.org/wiki/Northern_cardinal'
        },
        {
          commonName: 'Passenger Pigeon',
          scientificName: 'Ectopistes migratorius',
          lifeStatus: 'Extinct',
          region: 'North America',
          image: 'https://upload.wikimedia.org/wikipedia/commons/a/a3/Ectopistes_migratorius.jpg',
          wiki: 'https://en.wikipedia.org/wiki/Passenger_pigeon'
        },
        {
          commonName: 'Scarlet Macaw',
          scientificName: 'Ara macao',
          lifeStatus: 'Living',
          region: 'South America',
          image: 'https://upload.wikimedia.org/wikipedia/commons/a/a9/Scarlet_Macaw_-_Ara_macao_Luc_Viatour.jpg',
          wiki: 'https://en.wikipedia.org/wiki/Scarlet_macaw'
        },
        {
          commonName: 'Hoatzin',
          scientificName: 'Opisthocomus hoazin',
          lifeStatus: 'Living',
          region: 'South America',
          image: 'https://upload.wikimedia.org/wikipedia/commons/7/77/Hoatzin_-_clean_background.jpg',
          wiki: 'https://en.wikipedia.org/wiki/Hoatzin'
        },
        {
          commonName: 'Atlantic Puffin',
          scientificName: 'Fratercula arctica',
          lifeStatus: 'Living',
          region: 'Europe',
          image: 'https://upload.wikimedia.org/wikipedia/commons/3/3d/Atlantic_Puffin_Puffinus_puffinus.jpg',
          wiki: 'https://en.wikipedia.org/wiki/Atlantic_puffin'
        },
        {
          commonName: 'Lilac-breasted Roller',
          scientificName: 'Coracias caudatus',
          lifeStatus: 'Living',
          region: 'Africa',
          image: 'https://upload.wikimedia.org/wikipedia/commons/4/48/Lilac-breasted_Roller_2_-_color.jpg',
          wiki: 'https://en.wikipedia.org/wiki/Lilac-breasted_roller'
        },
        {
          commonName: 'Philippine Eagle',
          scientificName: 'Pithecophaga jefferyi',
          lifeStatus: 'Living',
          region: 'Asia',
          image: 'https://upload.wikimedia.org/wikipedia/commons/e/e4/Philippine_Eagle_Pithecophaga_jefferyi.jpg',
          wiki: 'https://en.wikipedia.org/wiki/Philippine_eagle'
        },
        {
          commonName: 'KƒÅkƒÅp≈ç',
          scientificName: 'Strigops habroptilus',
          lifeStatus: 'Living',
          region: 'Oceania',
          image: 'https://upload.wikimedia.org/wikipedia/commons/7/76/Kakapo_2.jpg',
          wiki: 'https://en.wikipedia.org/wiki/Kakapo'
        },
        {
          commonName: 'Dodo',
          scientificName: 'Raphus cucullatus',
          lifeStatus: 'Extinct',
          region: 'Island',
          image: 'https://upload.wikimedia.org/wikipedia/commons/3/32/Raphus_cucullatus_-_K%c3%b6nigl._Nat._Hist._Mus._Stockholm_-_Archaeology_-_Unknown_-_Unknown.jpg',
          wiki: 'https://en.wikipedia.org/wiki/Dodo'
        }
      ];
      const favoritesKey = 'birdPromptFavorites';
      const historyKey = 'birdPromptHistory';
      const state = {
        currentBird: null,
        currentAction: '',
        currentStyle: '',
        currentView: '',
        currentLifeStatus: '',
        currentRegion: '',
        currentPromptText: '',
        locks: {
          bird: false,
          action: false,
          style: false,
          view: false,
          lifeStatus: false,
          region: false
        },
        cache: [],
        favorites: [],
        history: [],
        isGenerating: false
      };
      let generateBtn;
      let copyBtn;
      let saveFavoriteBtn;
      let lifeSelect;
      let regionSelect;
      let statusMessage;
      let promptText;
      let birdCommonEl;
      let scientificEl;
      let detailLifeStatus;
      let detailRegion;
      let referenceImage;
      let referenceLink;
      let favoritesList;
      let historyList;
      let promptCard;
      document.addEventListener('DOMContentLoaded', () => {
        generateBtn = document.getElementById('generateBtn');
        copyBtn = document.getElementById('copyPrompt');
        saveFavoriteBtn = document.getElementById('saveFavorite');
        lifeSelect = document.getElementById('lifeSelect');
        regionSelect = document.getElementById('regionSelect');
        statusMessage = document.getElementById('statusMessage');
        promptText = document.getElementById('promptText');
        birdCommonEl = document.getElementById('birdCommon');
        scientificEl = document.getElementById('scientificName');
        detailLifeStatus = document.getElementById('detailLifeStatus');
        detailRegion = document.getElementById('detailRegion');
        referenceImage = document.getElementById('referenceImage');
        referenceLink = document.getElementById('referenceLink');
        favoritesList = document.getElementById('favoritesList');
        historyList = document.getElementById('historyList');
        promptCard = document.querySelector('.prompt-card');
        const lockButtons = document.querySelectorAll('[data-lock]');
        lockButtons.forEach((button) => {
          button.addEventListener('click', () => {
            const lockKey = button.dataset.lock;
            state.locks[lockKey] = !state.locks[lockKey];
            button.classList.toggle('active', state.locks[lockKey]);
            button.setAttribute('aria-pressed', String(state.locks[lockKey]));
          });
        });
        generateBtn.addEventListener('click', handleGenerate);
        copyBtn.addEventListener('click', copyPrompt);
        saveFavoriteBtn.addEventListener('click', saveFavorite);
        historyList.addEventListener('click', handleHistoryClick);
        favoritesList.addEventListener('click', handleFavoriteClick);
        setStatus('Tap generate to invite a feathered muse.');
        loadFavorites();
        loadHistory();
        updatePromptDisplay();
        handleGenerate();
      });
      function setStatus(message, type = 'info') {
        if (!statusMessage) return;
        statusMessage.textContent = message;
        statusMessage.dataset.state = type;
      }
      function toggleGenerateState(isLoading) {
        if (!generateBtn) return;
        generateBtn.disabled = isLoading;
        generateBtn.classList.toggle('loading', isLoading);
        generateBtn.setAttribute('aria-busy', isLoading ? 'true' : 'false');
      }
      function pickRandom(list, exclude) {
        if (!list.length) return '';
        if (list.length === 1) return list[0];
        let choice = list[Math.floor(Math.random() * list.length)];
        if (choice === exclude) {
          const altList = list.filter((item) => item !== exclude);
          choice = altList[Math.floor(Math.random() * altList.length)];
        }
        return choice;
      }
      function attemptBirdSelection(filters) {
        const matches = birds.filter((bird) => {
          const lifeMatch = filters.lifeStatus ? bird.lifeStatus === filters.lifeStatus : true;
          const regionMatch = filters.region ? bird.region === filters.region : true;
          return lifeMatch && regionMatch;
        });
        if (matches.length) {
          return matches[Math.floor(Math.random() * matches.length)];
        }
        const cacheMatches = state.cache.filter((bird) => {
          const lifeMatch = filters.lifeStatus ? bird.lifeStatus === filters.lifeStatus : true;
          const regionMatch = filters.region ? bird.region === filters.region : true;
          return lifeMatch && regionMatch;
        });
        if (cacheMatches.length) {
          return cacheMatches[0];
        }
        return null;
      }
      function cacheBird(bird) {
        state.cache = state.cache.filter((entry) => entry.commonName !== bird.commonName);
        state.cache.unshift(bird);
        if (state.cache.length > 20) {
          state.cache.pop();
        }
      }
      function formatPrompt(bird, style, view, action) {
        const lifeLower = bird.lifeStatus.toLowerCase();
        return `Create a ${style} depiction of a ${bird.commonName} (${bird.scientificName}), ${view} view, ${action}. Region inspiration: ${bird.region}. Life status: ${lifeLower}.`;
      }
      function updatePromptDisplay() {
        if (!promptText) return;
        promptText.textContent = state.currentPromptText || 'Tap ‚ÄúGenerate Prompt‚Äù to start.';
        birdCommonEl.textContent = state.currentBird ? state.currentBird.commonName : '‚Äî';
        scientificEl.textContent = state.currentBird ? state.currentBird.scientificName : '‚Äî';
        detailLifeStatus.textContent = state.currentBird ? state.currentBird.lifeStatus : '‚Äî';
        detailRegion.textContent = state.currentBird ? state.currentBird.region : '‚Äî';
        if (state.currentBird) {
          referenceImage.src = state.currentBird.image;
          referenceImage.alt = `${state.currentBird.commonName} reference`;
          referenceLink.href = state.currentBird.wiki;
          referenceLink.textContent = 'Source image on Wikipedia ‚Üó';
        }
        if (promptCard) {
          promptCard.classList.add('fresh');
          setTimeout(() => promptCard.classList.remove('fresh'), 800);
        }
      }
      function handleGenerate() {
        if (state.isGenerating) return;
        state.isGenerating = true;
        setStatus('Finding a bird‚Ä¶');
        toggleGenerateState(true);
        setTimeout(() => {
          const lifeFilter = state.locks.lifeStatus && state.currentLifeStatus ? state.currentLifeStatus : (lifeSelect.value !== 'Any' ? lifeSelect.value : null);
          const regionFilter = state.locks.region && state.currentRegion ? state.currentRegion : (regionSelect.value !== 'Any' ? regionSelect.value : null);
          const filters = {
            lifeStatus: lifeFilter,
            region: regionFilter
          };
          const selectedBird = state.locks.bird && state.currentBird ? state.currentBird : attemptBirdSelection(filters);
          if (!selectedBird) {
            setStatus("Couldn't find a match ‚Äî try again.", 'error');
            toggleGenerateState(false);
            state.isGenerating = false;
            return;
          }
          state.currentBird = selectedBird;
          state.currentLifeStatus = selectedBird.lifeStatus;
          state.currentRegion = selectedBird.region;
          const actionChoice = state.locks.action && state.currentAction ? state.currentAction : pickRandom(actionsList, state.currentAction);
          state.currentAction = actionChoice;
          const styleChoice = state.locks.style && state.currentStyle ? state.currentStyle : pickRandom(stylesList, state.currentStyle);
          state.currentStyle = styleChoice;
          const viewChoice = state.locks.view && state.currentView ? state.currentView : pickRandom(viewsList, state.currentView);
          state.currentView = viewChoice;
          const prompt = formatPrompt(selectedBird, state.currentStyle, state.currentView, state.currentAction);
          state.currentPromptText = prompt;
          updatePromptDisplay();
          cacheBird(selectedBird);
          logHistory({
            prompt,
            bird: { ...selectedBird },
            action: state.currentAction,
            style: state.currentStyle,
            view: state.currentView,
            lifeStatus: selectedBird.lifeStatus,
            region: selectedBird.region,
            timestamp: Date.now()
          });
          setStatus('Prompt ready ‚Äî let the wings inspire you.', 'success');
          toggleGenerateState(false);
          state.isGenerating = false;
        }, 600);
      }
      function saveFavorite() {
        if (!state.currentPromptText || !state.currentBird) return;
        const favorite = {
          prompt: state.currentPromptText,
          bird: { ...state.currentBird },
          action: state.currentAction,
          style: state.currentStyle,
          view: state.currentView,
          timestamp: Date.now()
        };
        state.favorites = state.favorites.filter((item) => item.prompt !== favorite.prompt);
        state.favorites.unshift(favorite);
        if (state.favorites.length > 20) {
          state.favorites.pop();
        }
        persistFavorites();
        renderFavorites();
        setStatus('Saved to favorites. It stays on this device only.', 'success');
      }
      function removeFavorite(index) {
        if (index < 0 || index >= state.favorites.length) return;
        state.favorites.splice(index, 1);
        persistFavorites();
        renderFavorites();
        setStatus('Favorite removed.', 'info');
      }
      function handleFavoriteClick(event) {
        const button = event.target.closest('[data-remove-fav]');
        if (!button) return;
        const index = Number(button.dataset.removeFav);
        removeFavorite(index);
      }
      function handleHistoryClick(event) {
        const button = event.target.closest('[data-history-index]');
        if (!button) return;
        const index = Number(button.dataset.historyIndex);
        const entry = state.history[index];
        if (!entry) return;
        applyHistoryEntry(entry);
      }
      function applyHistoryEntry(entry) {
        state.currentBird = entry.bird;
        state.currentAction = entry.action;
        state.currentStyle = entry.style;
        state.currentView = entry.view;
        state.currentLifeStatus = entry.lifeStatus;
        state.currentRegion = entry.region;
        state.currentPromptText = entry.prompt;
        updatePromptDisplay();
        cacheBird(entry.bird);
        logHistory({
          prompt: entry.prompt,
          bird: { ...entry.bird },
          action: entry.action,
          style: entry.style,
          view: entry.view,
          lifeStatus: entry.lifeStatus,
          region: entry.region,
          timestamp: Date.now()
        });
        setStatus('Reloaded from history ‚Äî explore the pose or style again.', 'success');
      }
      function logHistory(entry) {
        state.history = state.history.filter((item) => item.prompt !== entry.prompt);
        state.history.unshift(entry);
        if (state.history.length > 10) {
          state.history.pop();
        }
        persistHistory();
        renderHistory();
      }
      function renderFavorites() {
        if (!favoritesList) return;
        favoritesList.innerHTML = '';
        if (!state.favorites.length) {
          favoritesList.innerHTML = '<p class="helper">No favorites yet.</p>';
          return;
        }
        state.favorites.forEach((favorite, index) => {
          const article = document.createElement('article');
          article.className = 'favorite-card';
          const date = formatTimestamp(favorite.timestamp);
          article.innerHTML = `
            <p class="prompt-snippet">${favorite.prompt}</p>
            <div class="favorite-meta">
              <span class="timestamp">${date}</span>
              <button type="button" data-remove-fav="${index}" aria-label="Remove favorite">Remove</button>
            </div>
          `;
          favoritesList.appendChild(article);
        });
      }
      function renderHistory() {
        if (!historyList) return;
        historyList.innerHTML = '';
        if (!state.history.length) {
          historyList.innerHTML = '<p class="helper">History logs appear after you generate.</p>';
          return;
        }
        state.history.forEach((entry, index) => {
          const article = document.createElement('article');
          article.className = 'history-card';
          const date = formatTimestamp(entry.timestamp);
          article.innerHTML = `
            <p class="prompt-snippet">${entry.prompt}</p>
            <div class="history-actions">
              <button type="button" data-history-index="${index}">Reload</button>
              <span class="timestamp">${date}</span>
            </div>
          `;
          historyList.appendChild(article);
        });
      }
      function loadFavorites() {
        state.favorites = readStorage(favoritesKey);
        renderFavorites();
      }
      function loadHistory() {
        state.history = readStorage(historyKey);
        renderHistory();
      }
      function persistFavorites() {
        safeSet(favoritesKey, state.favorites);
      }
      function persistHistory() {
        safeSet(historyKey, state.history);
      }
      function readStorage(key) {
        if (typeof localStorage === 'undefined') return [];
        try {
          const stored = localStorage.getItem(key);
          return stored ? JSON.parse(stored) : [];
        } catch (error) {
          return [];
        }
      }
      function safeSet(key, value) {
        if (typeof localStorage === 'undefined') return;
        try {
          localStorage.setItem(key, JSON.stringify(value));
        } catch (error) {
          // silent
        }
      }
      function formatTimestamp(timestamp) {
        if (!timestamp) return '';
        return new Date(timestamp).toLocaleString(undefined, {
          month: 'short',
          day: 'numeric',
          hour: 'numeric',
          minute: '2-digit'
        });
      }
      async function copyPrompt() {
        if (!state.currentPromptText) return;
        const defaultLabel = 'Copy Prompt';
        try {
          await navigator.clipboard.writeText(state.currentPromptText);
          copyBtn.textContent = 'Copied!';
        } catch {
          const textarea = document.createElement('textarea');
          textarea.value = state.currentPromptText;
          textarea.setAttribute('readonly', '');
          textarea.style.position = 'absolute';
          textarea.style.left = '-9999px';
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand('copy');
          document.body.removeChild(textarea);
          copyBtn.textContent = 'Copied!';
        }
        setTimeout(() => {
          if (copyBtn) copyBtn.textContent = defaultLabel;
        }, 1200);
      }
    })();
  </script>
</body>
</html>
